---
title: "Demonstration of the correlation generated by similar durations"
output: 
    github_document: default
---

Generate pairs of random time-series and correlate the abs(slope). Time-series have a random length 3 to 100 steps.
```{r}
require(data.table)


## too slow
n<- 98*1000
dat <- data.table(duration = rep(3:100, n/98, replace=TRUE), slope1 = NA_real_, slope2 = NA_real_)
for(i in 1:n){
    dat$slope1[i] <- coef(lm(I(rnorm(dat$duration[i])) ~ I(1:dat$duration[i])))[2]
    dat$slope2[i] <- coef(lm(I(rnorm(dat$duration[i])) ~ I(1:dat$duration[i])))[2]
}
```


# Plot the slopes
```{r}

dat[, plot(slope1, slope2)]
dat[, plot(abs(slope1), abs(slope2))]
dat[, plot(abs(slope1), abs(slope3))]
```

# Correlation of variable durations
Notice the strongly significant correlation when taking the absolute value of the slope
```{r}
cors <- data.table(minduration = rep(50:3,10), maxduration = rep(50:100, 10), p = NA_real_, cor = NA_real_)
for(i in 1:nrow(cors)){
    thisdat <- dat[duration <= cors$minduration[i] & duration <= cors$maxduration[i], ][sample(.N, 1000)]
    test <- cor.test(thisdat$slope1, thisdat$slope2)
}
cor.test(dat$slope1, dat$slope2)
cor.test(abs(dat$slope1), abs(dat$slope2))
cor.test(abs(dat$slope1), abs(dat$slope2))
```

# Correlation of 5-step durations
Notice the induced correlation goes away.
```{r}
cor.test(dat5$slope1, dat5$slope2)
cor.test(abs(dat5$slope1), abs(dat5$slope2))
cor.test(abs(dat5$slope1), abs(dat5$slope2))
```

# Correlation of 20-step durations
Notice the induced correlation goes away.
```{r}
cor.test(dat20$slope1, dat20$slope2)
cor.test(abs(dat20$slope1), abs(dat20$slope2))
cor.test(abs(dat20$slope1), abs(dat20$slope2))
```


         
         